syntax = "proto3";

package meme.json_api;
option go_package = "github.com/materkov/meme9/api/json_api";

// JSON API service definitions for REST endpoints
service JsonAPI {
  // Feed API - GET /api/feed
  rpc GetFeed(FeedRequest) returns (FeedResponse);
  
  // Publish API - POST /api/publish
  rpc Publish(PublishRequest) returns (PublishResponse);
  
  // Login API - POST /api/login
  rpc Login(LoginRequest) returns (LoginResponse);
  
  // Register API - POST /api/register
  rpc Register(RegisterRequest) returns (LoginResponse);
  
  // UserPosts API - POST /api/userPosts
  rpc GetUserPosts(UserPostsRequest) returns (UserPostsResponse);
  
  // Subscribe API - POST /api/subscribe
  rpc Subscribe(SubscribeRequest) returns (SubscribeResponse);
  
  // Unsubscribe API - POST /api/unsubscribe
  rpc Unsubscribe(SubscribeRequest) returns (SubscribeResponse);
  
  // SubscriptionStatus API - POST /api/subscriptionStatus
  rpc GetSubscriptionStatus(SubscribeRequest) returns (SubscribeResponse);
  
  // GetFollowing API - POST /api/getFollowing
  rpc GetFollowing(GetFollowingRequest) returns (GetFollowingResponse);
  
  // GetPost API - POST /api/getPost
  rpc GetPost(GetPostRequest) returns (GetPostResponse);
  
  // GetUser API - POST /api/getUser
  rpc GetUser(GetUserRequest) returns (GetUserResponse);
  
  // VerifyToken API - POST /api/verifyToken
  rpc VerifyToken(VerifyTokenRequest) returns (VerifyTokenResponse);
  
  // IsSubscribed API - POST /api/isSubscribed
  rpc IsSubscribed(IsSubscribedRequest) returns (IsSubscribedResponse);
  
  // GetPostsByUserIDs API - POST /api/getPostsByUserIDs
  rpc GetPostsByUserIDs(GetPostsByUserIDsRequest) returns (GetPostsByUserIDsResponse);
  
  // GetUsersByIDs API - POST /api/getUsersByIDs
  rpc GetUsersByIDs(GetUsersByIDsRequest) returns (GetUsersByIDsResponse);
}

// Feed API - GET /api/feed
message FeedRequest {
  string type = 1; // "all" or "subscriptions"
}

message FeedPostResponse {
  string id = 1;
  string text = 2;
  string user_id = 3;
  string username = 4;
  string created_at = 5; // RFC3339 format
}

message FeedResponse {
  repeated FeedPostResponse posts = 1;
}

// Publish API - POST /api/publish
message PublishRequest {
  string text = 1;
}

message PublishResponse {
  string id = 1;
}

// Login API - POST /api/login
message LoginRequest {
  string username = 1;
  string password = 2;
}

message LoginResponse {
  string token = 1;
  string user_id = 2;
  string username = 3;
}

// Register API - POST /api/register
message RegisterRequest {
  string username = 1;
  string password = 2;
}

// Uses LoginResponse

// UserPosts API - POST /api/userPosts
message UserPostsRequest {
  string user_id = 1;
}

message UserPostResponse {
  string id = 1;
  string text = 2;
  string user_id = 3;
  string username = 4;
  string created_at = 5; // RFC3339 format
}

message UserPostsResponse {
  repeated UserPostResponse posts = 1;
}

// Subscribe API - POST /api/subscribe
message SubscribeRequest {
  string user_id = 1;
}

message SubscribeResponse {
  bool subscribed = 1;
}

// Unsubscribe API - POST /api/unsubscribe
// Uses SubscribeRequest and SubscribeResponse

// SubscriptionStatus API - POST /api/subscriptionStatus
// Uses SubscribeRequest and SubscribeResponse

// GetFollowing API - POST /api/getFollowing
message GetFollowingRequest {
  string user_id = 1;
}

message GetFollowingResponse {
  repeated string user_ids = 1;
}

// GetPost API - POST /api/getPost
message GetPostRequest {
  string post_id = 1;
}

message GetPostResponse {
  string id = 1;
  string text = 2;
  string user_id = 3;
  string created_at = 4; // RFC3339 format
}

// GetUser API - POST /api/getUser
message GetUserRequest {
  string user_id = 1;
}

message GetUserResponse {
  string id = 1;
  string username = 2;
}

// VerifyToken API - POST /api/verifyToken
message VerifyTokenRequest {
  string token = 1;
}

message VerifyTokenResponse {
  string user_id = 1;
}

// IsSubscribed API - POST /api/isSubscribed
message IsSubscribedRequest {
  string subscriber_id = 1;
  string target_user_id = 2;
}

message IsSubscribedResponse {
  bool subscribed = 1;
}

// GetPostsByUserIDs API - POST /api/getPostsByUserIDs
message GetPostsByUserIDsRequest {
  repeated string user_ids = 1;
}

message GetPostsByUserIDsResponse {
  repeated GetPostResponse posts = 1;
}

// GetUsersByIDs API - POST /api/getUsersByIDs
message GetUsersByIDsRequest {
  repeated string user_ids = 1;
}

message GetUsersByIDsResponse {
  map<string, GetUserResponse> users = 1;
}

// Error response (used across all endpoints)
message ErrorResponse {
  string error = 1;
  string error_details = 2;
}

